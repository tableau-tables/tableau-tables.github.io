
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Tableau-table: enhanced table markup for Markdown">
      
      
        <meta name="author" content="Dave Thomas (@pragdave)">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.3">
    
    
      
        <title>Using the Tableau Table Library to write a JavaScript Extension - Tableau: Enhanced Markdown Tables</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4a0965b7.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/css/tableau.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#using-the-tableau-table-library-to-write-a-javascript-extension" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Tableau: Enhanced Markdown Tables" class="md-header__button md-logo" aria-label="Tableau: Enhanced Markdown Tables" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tableau: Enhanced Markdown Tables
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Using the Tableau Table Library to write a JavaScript Extension
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_3" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_3">
          
            <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Tableau: Enhanced Markdown Tables" class="md-nav__button md-logo" aria-label="Tableau: Enhanced Markdown Tables" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Tableau: Enhanced Markdown Tables
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Tableau: Extended Table Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../samples/" class="md-nav__link">
        Samples
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Using the Tableau Table Library to write a JavaScript Extension
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Using the Tableau Table Library to write a JavaScript Extension
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-tableau-table-library" class="md-nav__link">
    The Tableau Table Library
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-input-string" class="md-nav__link">
    The Input String
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-ast" class="md-nav__link">
    The Ast
  </a>
  
    <nav class="md-nav" aria-label="The Ast">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rows" class="md-nav__link">
    Rows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cells-and-formats" class="md-nav__link">
    Cells and Formats
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-tableau-table-library" class="md-nav__link">
    The Tableau Table Library
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-input-string" class="md-nav__link">
    The Input String
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-ast" class="md-nav__link">
    The Ast
  </a>
  
    <nav class="md-nav" aria-label="The Ast">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rows" class="md-nav__link">
    Rows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cells-and-formats" class="md-nav__link">
    Cells and Formats
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="using-the-tableau-table-library-to-write-a-javascript-extension">Using the Tableau Table Library to write a JavaScript Extension</h1>
<p>Most every Markdown processor has some form of extension of plugin
mechanism. Although it is redundant to say it here, be sure to spend a
little while reading how your particular processor implements plugins.</p>
<p>In general, Markdown processors operate as a pipeline of modules, where
each module parses, manipulates, of generates output. </p>
<p>Some processors take this further and have separate pipelines for
different stages of processing: tokenizing or parsing, handling blocks,
handling inline segments, creating indices, and generating HTML, for
example.</p>
<p>Tableau deals with tables. Tables are a Markdown block element, and so
in a pipeline processor you'll be adding code at the block level.</p>
<p>The lax syntax of Markdown makes it difficult for processors to be
certain what kind of block they are looking at: is it a table, or just a
paragraph with a pipe character? They commonly deal with this by having
extensions perform a quick sanity check (typically a regular expression
match on a block of text). If this passes, the processor can then call
the main code of the extension. Even it this point, an extension can
discover that the quick test was wrong, and that the block is not one
it handles, in which case it uses a specific return value to tell the
processor to try an alternative.</p>
<p>Processors also differ when in comes to generating HTML. Sometimes the
extension generates HTML when it first processes the block, and other
times it instead saves information, and the processor will call a
separate function to convert that saved information into HTML it can
use.</p>
<h2 id="the-tableau-table-library">The Tableau Table Library</h2>
<p>The tableau API has three functions: </p>
<dl>
<dt><code>test(src: string): boolean</code></dt>
<dd>pass this function a string, at it returns <code>true</code> if that string
<em>might</em> represent a tableau table, false otherwise. This is the
quick-n-nasty regular expression hack.</dd>
<dt><code>to_ast(str): Ast | false</code></dt>
<dd>takes a string containing a possible tableau table, validates that it
is, and then returns a data structure describing the table contents.
This structure is described below.</dd>
<dt><code>ast_to_html(ast: Ast): string</code></dt>
<dd>The <code>ast_to_html</code> function takes an AST and generates an HTML
representation. The format of this HTML is described below. This
function might not be usable if your Markdown processor requires you to
use its functions to generate HTML tags. In that case you can always
copy the overall structure of the <code>ast_to_html</code> function's code in your
code.</dd>
</dl>
<h2 id="the-input-string">The Input String</h2>
<p>The input to both <code>test</code> and <code>to_ast</code> is a single string containing
newline-separated lines. Before being processed, the library strips
leading and trailing spaces from the string, and then combines any line
that ends with a backslash character with the next line.</p>
<h2 id="the-ast">The Ast</h2>
<p>The Ast represents the whole tab split_out_head<code>le. The Ast has some
table-level attributes (</code>row_count<code>,</code>col_count<code>,</code>caption<code>, and</code>table_classes`), and exports two functions:</p>
<div class="highlight"><pre><span></span><code><span class="nx">ast</span><span class="p">.</span><span class="nx">split_out_head</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">head</span><span class="o">:</span><span class="w"> </span><span class="kt">Row</span><span class="p">[],</span><span class="w"> </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="kt">Row</span><span class="p">[]</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="nx">ast</span><span class="p">.</span><span class="nx">each_row</span><span class="p">((</span><span class="nx">row</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">...)</span><span class="w"></span>
</code></pre></div>
<p>One of Ast's jobs is to work out which rows are table headers. Use
the <code>split_out_head</code> function to return two lists of rows. 
The <code>head</code> entry contains zero or more rows that constitute the table's
header (and will likely wind up inside a <code>&lt;thead&gt;</code> tag). The <code>body</code>
entry is the rest of the rows.</p>
<p>Sometimes you need to be able to iterate over all rows, header or not
(we'll see an example of this when we implement the marked extension
below). That's what <code>each_row</code> is for.</p>
<h3 id="rows">Rows</h3>
<p>Rows are simply wrappers for a list of cells. They export a single
function:</p>
<div class="highlight"><pre><span></span><code><span class="nx">row</span><span class="p">.</span><span class="nx">each_cell</span><span class="p">((</span><span class="nx">cell</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w">  </span><span class="p">...</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>Rows have no useful attributes.</p>
<h3 id="cells-and-formats">Cells and Formats</h3>
<p>A <code>Cell</code> represents a (possibly hidden) rectangular cell in the table.</p>
<p>Each cell has six attributes:</p>
<dl>
<dt><code>rowspan_count</code><br/><code>colspan_count</code></dt>
<dd>the number of rows, columns, or both this cell should merge with. If
the cell is not supposed to merge, the value will be zero. To
create a <code>rowspan</code> or <code>colspan</code> attribute value, you'll need to add one
to these values.</dd>
<dt><code>hidden</code></dt>
<dd>if a cell is being spanned over, then it is marked as hidden, and you
shouldn't generate any HTML for it.</dd>
<dt><code>content</code></dt>
<dd>a string containing the cell's text content. This string will 
not have been processed yet, so at some point you'll need to ensure it
goes througth a markdown processor.</dd>
<dt><code>format</code></dt>
<dd>any object containing the formatting information for this cell (see
below)</dd>
<dt><code>data</code></dt>
<dd>an attribute that is not used by the tableau library. You can use it
to pass information between various phases of the processing pipeline.</dd>
</dl>
<p>The <code>Format</code> object s four attributes you may use: </p>
<dl>
<dt><code>alignment</code></dt>
<dd>a single character string: "&lt;", "=", or "&gt;" for left, center, or
right.</dd>
<dt><code>span</code></dt>
<dd>If this cell is merged with the preceding row or column, this field
will contain "^" or "{". You probably won't use this, as the Ast will
have already merged cells and set <code>rowspan_count</code> and <code>colspan_count</code> in
the cell being merged from.</dd>
<dt><code>css_classes</code></dt>
<dd>A list of css_classes specified for this cell.</dd>
<dt><code>heading</code></dt>
<dd>if <code>true</code>, this cell is a heading (rendered using <code>&lt;th&gt;</code>)</dd>
</dl>
<h1 id="extension-example">Extension Example</h1>
<p>This section looks at the source for a tableau table plugin for the
Marked processor.</p>
<p>Before we start, we need to create a new project and 
install the tableau library and Marked:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>mkdir tableau-marked
<span class="gp">$ </span><span class="nb">cd</span> tableau-marked
<span class="gp">$ </span>yarn init -y
<span class="gp">$ </span>git init
<span class="gp">$ </span>yarn add -S js-tableau-parser
<span class="gp">$ </span>yarn add -S marked
<span class="gp">$ </span>yarn add -D @types/marked
<span class="gp">$ </span>mkdir src
</code></pre></div>
<p>Then do whatever magic you normally do to set up a build environment. </p>
<h3 id="shape-of-the-extension">Shape of the Extension</h3>
<p>Marked is a pipeline processor. We need to insert parts of our extension
into three parts of that pipeline:</p>
<ul>
<li>
<p>The <code>start</code> code, which is used to test whether a block might be
  suitable for processing with this extension.</p>
</li>
<li>
<p>The <code>tokenizer</code>, where we'll parser our table and, if successful,
  insert a new token containing our AST into the Marked pipeline.</p>
</li>
<li>
<p>The <code>renderer</code>, where we'll be called to handled the special <code>tableau</code>
  token we previously injected.</p>
</li>
</ul>
<p>These three phases correspond roughly to the <code>test</code>, <code>to_ast</code>, and
<code>ast_to_html</code> APIs in the tableau library.</p>
<h3 id="source-code">Source Code</h3>
<p>We'll create our extension in <code>src/tableau-marked.ts</code>.</p>
<div class="highlight"><span class="filename">src/tableau-marked.ts</span><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Tableau</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;js-tableau-parser&quot;</span><span class="w"> </span>
<span class="k">import</span><span class="w"> </span><span class="nx">Marked</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;marked&quot;</span><span class="w"></span>

<span class="kr">type</span><span class="w"> </span><span class="nx">Token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Marked</span><span class="p">.</span><span class="nx">marked</span><span class="p">.</span><span class="nx">Token</span><span class="w">  </span><span class="c1">// (1)</span><span class="w"></span>
</code></pre></div>
<ol>
<li>It took me a while to find the correct type definition, so
   I aliased it as a reminder to my future, forgetful, self.</li>
</ol>
<p>A Marked extension module exports a descriptor, contain the name and
type of extension, and a list of functions to inject into the pipeline.</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">TABLEAU_EXTENSION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w">  </span><span class="s1">&#39;tableau&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nx">level</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;block&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nx">start</span><span class="o">:</span><span class="w"> </span><span class="kt">Tableau.test</span><span class="p">,</span><span class="w">  </span><span class="c1">//(1)</span><span class="w"></span>
<span class="w">  </span><span class="nx">tokenizer</span><span class="p">,</span><span class="w">            </span><span class="c1">//(2)</span><span class="w"></span>
<span class="w">  </span><span class="nx">renderer</span><span class="p">,</span><span class="w">             </span><span class="c1">//(3)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">extensions</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nx">TABLEAU_EXTENSION</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<ol>
<li>
<p>The <code>start</code> callback is simply forwarded to the <code>test</code> function in
   the tableau library.</p>
</li>
<li>
<p>The <code>tokenizer</code> just calls our function of the same name.</p>
</li>
<li>
<p>And the same for the <code>renderer</code> function.</p>
</li>
</ol>
<p>The tokenizer needs to verify that the block it is passed contains two
or more table rows. That match is performed by the following regular
expression. </p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">TABLE_RE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">RegExp</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="sb">`(`</span><span class="w">          </span><span class="o">+</span><span class="w"></span>
<span class="w">    </span><span class="sb">`\\s{0,3}`</span><span class="w"> </span><span class="o">+</span><span class="w">     </span><span class="c1">//permitted indentation</span><span class="w"></span>
<span class="w">    </span><span class="sb">`\\|`</span><span class="w">      </span><span class="o">+</span><span class="w">     </span><span class="c1">//starting pipe</span><span class="w"></span>
<span class="w">    </span><span class="sb">`[^\\n]+`</span><span class="w">  </span><span class="o">+</span><span class="w">     </span><span class="c1">// body of the line (see [1] below)</span><span class="w"></span>
<span class="w">    </span><span class="sb">`\\|`</span><span class="w">      </span><span class="o">+</span><span class="w">     </span><span class="c1">// trailing pipe</span><span class="w"></span>
<span class="w">    </span><span class="sb">`\\s*\\n`</span><span class="w">  </span><span class="o">+</span><span class="w">     </span><span class="c1">// spaces nd EOL</span><span class="w"></span>
<span class="w">  </span><span class="sb">`){2,}`</span><span class="p">)</span><span class="w">           </span><span class="c1">// Two or more rows is a table</span><span class="w"></span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I like to use the <code>x</code> option so that I can space out and document
complex regexps, but JavaScript support is spotty, so instead I just
split it into lots of strings and concatenate them.</p>
</div>
<p>Now let's start the <code>tokenizer</code> function. Marked requires a tokenizer to
return a token object. This must have <code>type</code> and <code>raw</code> attributes. To
this we add an attribute to hold the ast.</p>
<div class="highlight"><pre><span></span><code><span class="kd">interface</span><span class="w"> </span><span class="nx">TableauToken</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;tableau&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nx">raw</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nx">ast</span><span class="o">:</span><span class="w"> </span><span class="kt">Tableau.Ast</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Marked calls the tokenizer with <code>this</code> set to an object containing
a lexer. In typescript, you indicate this by adding a typed <code>this</code> parameter
to the function definition. Again, here's an alias so I don't have to go grovelling through
the <code>index.d.ts</code> file again.</p>
<div class="highlight"><pre><span></span><code><span class="kr">type</span><span class="w"> </span><span class="nx">TokenizerThis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Marked</span><span class="p">.</span><span class="nx">marked</span><span class="p">.</span><span class="nx">TokenizerThis</span><span class="w"></span>
</code></pre></div>
<p>And now the tokenizer:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">tokenizer</span><span class="p">(</span><span class="nx">this</span><span class="o">:</span><span class="w"> </span><span class="kt">TokenizerThis</span><span class="p">,</span><span class="w"> </span>
<span class="w">                   </span><span class="nx">src</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span>
<span class="w">                   </span><span class="nx">_tokens</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">TableauToken</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">TABLE_RE</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">src</span><span class="p">);</span><span class="w">       </span><span class="c1">// (1)</span><span class="w"></span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">)</span><span class="w">                             </span><span class="c1">// (2)</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"></span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">ast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Tableau</span><span class="p">.</span><span class="nx">to_ast</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span><span class="w">    </span><span class="c1">// (3)</span><span class="w"></span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">ast</span><span class="p">)</span><span class="w">                               </span><span class="c1">// (4)</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"></span>

<span class="w">  </span><span class="c1">// marked makes you tokenize children here, then</span><span class="w"></span>
<span class="w">  </span><span class="c1">// render them later</span><span class="w"></span>
<span class="w">  </span><span class="nx">ast</span><span class="p">.</span><span class="nx">each_row</span><span class="p">(</span><span class="nx">row</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">row</span><span class="p">.</span><span class="nx">each_cell</span><span class="p">(</span><span class="nx">cell</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">tokens</span><span class="o">:</span><span class="w"> </span><span class="kt">Marked.marked.Token</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">lexer</span><span class="p">.</span><span class="nx">inlineTokens</span><span class="p">(</span><span class="nx">cell</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span><span class="w"> </span><span class="nx">tokens</span><span class="p">);</span><span class="w">    </span><span class="c1">// (5)</span><span class="w"></span>
<span class="w">      </span><span class="nx">cell</span><span class="p">.</span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tokens</span><span class="w"> </span>
<span class="w">    </span><span class="p">})</span><span class="w"></span>
<span class="w">  </span><span class="p">})</span><span class="w"></span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;tableau&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nx">raw</span><span class="o">:</span><span class="w"> </span><span class="kt">match</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="nx">ast</span><span class="o">:</span><span class="w"> </span><span class="kt">ast</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<ol>
<li>
<p>See if the block we receive matches the pattern we defined.</p>
</li>
<li>
<p>If the block doesn't match the pattern, return <code>undefined</code>, which
   tells Marked to try another tokenizer.</p>
</li>
<li>
<p>If it matches, we call the tableau <code>to_ast</code> function, passing it the
   matched text. This returns an ast object or false.</p>
</li>
<li>
<p>If the <code>to_ast</code> function failed, then we return <code>undefined</code> and
   Marked moves on to the next tokenizer.</p>
</li>
<li>
<p>Each cell in the AST contains its original markdown. We need to
   convert this into HTML by the time we generate output, but, as we've
   discovered, Marked makes this a two-step process. Here, we call
   Marked's inline-text tokenizer. The result of parsing the cell's
   content will be stored in the <code>tokens</code> array, which we then assign to
   the <code>data</code> attribute of the cell. We'll use it when we render.</p>
</li>
</ol>
<p>Now the <code>renderer</code> function. Before using the library's <code>ast_to_html</code>
function, it needs to retrieve the tokens representing each cell's
content, render it, and stick the resulting HTML back into the cell.</p>
<div class="highlight"><pre><span></span><code><span class="kr">type</span><span class="w"> </span><span class="nx">RendererThis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Marked</span><span class="p">.</span><span class="nx">marked</span><span class="p">.</span><span class="nx">RendererThis</span><span class="w"></span>

<span class="c1">// I _think_ there&#39;s a bug in the Marked index.d.ts: the parser passed</span><span class="w"></span>
<span class="c1">// to the renderer does not require a renderer as its second parameter</span><span class="w"></span>
<span class="kr">type</span><span class="w"> </span><span class="nx">ActualParseInline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tokens</span><span class="o">:</span><span class="w"> </span><span class="kt">Token</span><span class="p">[])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">renderer</span><span class="p">(</span><span class="nx">this</span><span class="o">:</span><span class="w"> </span><span class="kt">RendererThis</span><span class="p">,</span><span class="w"> </span><span class="nx">table</span><span class="o">:</span><span class="w"> </span><span class="kt">TableauToken</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">table</span><span class="p">.</span><span class="nx">ast</span><span class="p">.</span><span class="nx">each_row</span><span class="p">(</span><span class="nx">row</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nx">row</span><span class="p">.</span><span class="nx">each_cell</span><span class="p">(</span><span class="nx">cell</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">cell</span><span class="p">.</span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parser</span><span class="p">.</span><span class="nx">parseInline</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">ActualParseInline</span><span class="p">)(</span><span class="nx">cell</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">})</span><span class="w"></span>
<span class="w">    </span><span class="p">})</span><span class="w"></span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">Tableau</span><span class="p">.</span><span class="nx">ast_to_html</span><span class="p">(</span><span class="nx">table</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<details class="note"><summary>The full source file is here</summary><div class="highlight"><span class="filename">src/tableau-marked.ts</span><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Tableau</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;js-tableau-parser&quot;</span><span class="w"> </span>
<span class="k">import</span><span class="w"> </span><span class="nx">Marked</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;marked&quot;</span><span class="w"></span>

<span class="kr">type</span><span class="w"> </span><span class="nx">Token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Marked</span><span class="p">.</span><span class="nx">marked</span><span class="p">.</span><span class="nx">Token</span><span class="w"></span>


<span class="c1">////////////////////////////////////////////////////////////////////////</span><span class="w"></span>

<span class="kd">const</span><span class="w"> </span><span class="nx">TABLEAU_EXTENSION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w">  </span><span class="s1">&#39;tableau&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nx">level</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;block&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nx">start</span><span class="o">:</span><span class="w"> </span><span class="kt">Tableau.test</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nx">tokenizer</span><span class="p">,</span><span class="w"> </span><span class="c1">//: (src: string, tokens: Token[]) =&gt; tokenizer(src,  tokens),</span><span class="w"></span>
<span class="w">  </span><span class="nx">renderer</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">////////////////////////////////////////////////////////////////////////</span><span class="w"></span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">extensions</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nx">TABLEAU_EXTENSION</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">////////////////////////////////////////////////////////////////////////</span><span class="w"></span>


<span class="c1">// the following defines a row (text between pipe characters)</span><span class="w"></span>
<span class="kd">const</span><span class="w"> </span><span class="nx">TABLE_RE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">RegExp</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="sb">`(`</span><span class="w">          </span><span class="o">+</span><span class="w"></span>
<span class="w">    </span><span class="sb">`\\s{0,3}`</span><span class="w"> </span><span class="o">+</span><span class="w">     </span><span class="c1">//permitted indentation</span><span class="w"></span>
<span class="w">    </span><span class="sb">`\\|`</span><span class="w">      </span><span class="o">+</span><span class="w">     </span><span class="c1">//starting pipe</span><span class="w"></span>
<span class="w">    </span><span class="sb">`[^\\n]+`</span><span class="w">  </span><span class="o">+</span><span class="w">     </span><span class="c1">// body of the line (see [1] below)</span><span class="w"></span>
<span class="w">    </span><span class="sb">`\\|`</span><span class="w">      </span><span class="o">+</span><span class="w">     </span><span class="c1">// trailing pipe</span><span class="w"></span>
<span class="w">    </span><span class="sb">`\\s*\\n`</span><span class="w">  </span><span class="o">+</span><span class="w">     </span><span class="c1">// spaces nd EOL</span><span class="w"></span>
<span class="w">  </span><span class="sb">`){2,}`</span><span class="p">)</span><span class="w">           </span><span class="c1">// Two or more rows is a table</span><span class="w"></span>

<span class="c1">// TODO 1: this is a fairly inefficient regexp, as it will backtrack on each</span><span class="w"></span>
<span class="c1">// intermediate pipe in a table row. It can be fixed with some negative</span><span class="w"></span>
<span class="c1">// lookahead, but I want to keep it simple for now.</span><span class="w"></span>

<span class="c1">////////////////////////////////////////////////////////////////////////</span><span class="w"></span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">TableauToken</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;tableau&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nx">raw</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nx">ast</span><span class="o">:</span><span class="w"> </span><span class="kt">Tableau.Ast</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">type</span><span class="w"> </span><span class="nx">TokenizerThis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Marked</span><span class="p">.</span><span class="nx">marked</span><span class="p">.</span><span class="nx">TokenizerThis</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">tokenizer</span><span class="p">(</span><span class="nx">this</span><span class="o">:</span><span class="w"> </span><span class="kt">TokenizerThis</span><span class="p">,</span><span class="w"> </span><span class="nx">src</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">_tokens</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">TableauToken</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">TABLE_RE</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">src</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"></span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Tableau</span><span class="p">.</span><span class="nx">to_ast</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">ast</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"></span>

<span class="w">    </span><span class="c1">// marked make you tokenize children heere, then</span><span class="w"></span>
<span class="w">    </span><span class="c1">// render them later</span><span class="w"></span>
<span class="w">    </span><span class="nx">ast</span><span class="p">.</span><span class="nx">each_row</span><span class="p">(</span><span class="nx">row</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nx">row</span><span class="p">.</span><span class="nx">each_cell</span><span class="p">(</span><span class="nx">cell</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">tokens</span><span class="o">:</span><span class="w"> </span><span class="kt">Marked.marked.Token</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">lexer</span><span class="p">.</span><span class="nx">inlineTokens</span><span class="p">(</span><span class="nx">cell</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span><span class="w"> </span><span class="nx">tokens</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="nx">cell</span><span class="p">.</span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tokens</span><span class="w"> </span>
<span class="w">      </span><span class="p">})</span><span class="w"></span>
<span class="w">    </span><span class="p">})</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;tableau&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nx">raw</span><span class="o">:</span><span class="w"> </span><span class="kt">match</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="w"></span>
<span class="w">      </span><span class="nx">ast</span><span class="o">:</span><span class="w"> </span><span class="kt">ast</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>


<span class="c1">////////////////////////////////////////////////////////////////////////</span><span class="w"></span>

<span class="kr">type</span><span class="w"> </span><span class="nx">RendererThis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Marked</span><span class="p">.</span><span class="nx">marked</span><span class="p">.</span><span class="nx">RendererThis</span><span class="w"></span>

<span class="c1">// I _think_ there&#39;s a bug in the Markmed index.d.ts: the parser passed</span><span class="w"></span>
<span class="c1">// to the renderer does not require a renderer as its second parameter</span><span class="w"></span>
<span class="kr">type</span><span class="w"> </span><span class="nx">ActualParseInline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">tokens</span><span class="o">:</span><span class="w"> </span><span class="kt">Token</span><span class="p">[])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">renderer</span><span class="p">(</span><span class="nx">this</span><span class="o">:</span><span class="w"> </span><span class="kt">RendererThis</span><span class="p">,</span><span class="w"> </span><span class="nx">table</span><span class="o">:</span><span class="w"> </span><span class="kt">TableauToken</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">table</span><span class="p">.</span><span class="nx">ast</span><span class="p">.</span><span class="nx">each_row</span><span class="p">(</span><span class="nx">row</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nx">row</span><span class="p">.</span><span class="nx">each_cell</span><span class="p">(</span><span class="nx">cell</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">cell</span><span class="p">.</span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parser</span><span class="p">.</span><span class="nx">parseInline</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">ActualParseInline</span><span class="p">)(</span><span class="nx">cell</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">})</span><span class="w"></span>
<span class="w">    </span><span class="p">})</span><span class="w"></span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">Tableau</span><span class="p">.</span><span class="nx">ast_to_html</span><span class="p">(</span><span class="nx">table</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</details>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../samples/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Samples" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Samples
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright  2022 Dave Thomas
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate"], "search": "../assets/javascripts/workers/search.b028fd86.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f758a944.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>